000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. usecase1.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT invoer ASSIGN TO "parameters.txt"
           ORGANIZATION IS LINE SEQUENTIAL.
           SELECT uitvoer ASSIGN TO naamNieuweCSV
           ORGANIZATION IS LINE SEQUENTIAL.
       DATA DIVISION.
       FILE SECTION.
       FD invoer.
       copy parameters.
       FD uitvoer.
       copy usersCSV.
       WORKING-STORAGE SECTION.
       01 CSVtabel.
           05 kolommen          PIC X(255)      OCCURS 999 TIMES.
           05 #rijen            PIC 9(3).
       01 lijstWW.
           05 randomWW          PIC X(8)        OCCURS 999 TIMES.
       01 conditie              PIC X.
            88 eof                              VALUE HIGH-VALUES.
       01 tellers.
           05 i                 PIC 9(2).
           05 j                 PIC 9(2).
       01 ConnGeg               PIC X(255).
       01 naamNieuweCSV         Pic X(25).
       PROCEDURE DIVISION.
       PGM.
           OPEN INPUT invoer
            READ invoer
                AT END 
                 MOVE HIGH-VALUES to conditie
                 CALL 'LogHandler' 
                 USING "Het bestand kan niet worden gevonden of is leeg"
            END-READ           
            MOVE connstring TO ConnGeg
            PERFORM CONNECTDB
            PERFORM VARYING i FROM 1 BY 1 until eof
            IF naamCSV (i) = SPACE OR naamCSV (i) = LOW-VALUES
            THEN MOVE HIGH-VALUES TO conditie
            ELSE
              CALL 'CSVReader' USING naamCSV(i) RETURNING CSVtabel
              IF #rijen > 0 PERFORM GENCSV END-IF
            END-IF
            END-PERFORM
           CLOSE invoer
           STOP RUN
       .
       CONNECTDB.
           CALL 'dbConn' USING ConnGeg
       .
       
       GENCSV.
           CAll 'PWGenerator' USING #rijen RETURNING lijstWW
           STRING naamCSV (i) DELIMITED BY SPACE
                  ".OUT"      DELIMITED BY SIZE
                  INTO naamNieuweCSV
           OPEN OUTPUT uitvoer
           PERFORM VARYING j FROM 1 BY 1 UNTIL j > #rijen 
           UNSTRING kolommen(j) DELIMITED BY ";" INTO Userdata
           MOVE randomWW(j) TO wachtwoord
           WRITE Userdata
           END-PERFORM
           CLOSE uitvoer
       .
